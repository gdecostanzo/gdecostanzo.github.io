<!doctype html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Jekyll">
    <link rel="license" href="LICENSE">

    <meta name="application-name" content="Giovanni's Blog">
    <meta name="theme-color" content="">
    <link rel="archives" href="https://gdecostanzo.github.io/archives/">

    <meta name="robots" content="index,follow"> <!-- All Search Engines -->
    <meta name="googlebot" content="index,follow"><!-- Google Specific    -->

    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/pure-min.css">
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/grids-responsive-min.css">
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="stylesheet" href="/assets/code.css">
    <script src="https://kit.fontawesome.com/e9dddf84a6.js" crossorigin="anonymous"></script><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>PiFace Digital 2 - Creare una Web interface in PHP | Giovanniâ€™s Blog</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="PiFace Digital 2 - Creare una Web interface in PHP" />
<meta name="author" content="Giovanni De Costanzo" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This is the personal website of Giovanni De Costanzo." />
<meta property="og:description" content="This is the personal website of Giovanni De Costanzo." />
<link rel="canonical" href="https://gdecostanzo.github.io/PiFace-Web" />
<meta property="og:url" content="https://gdecostanzo.github.io/PiFace-Web" />
<meta property="og:site_name" content="Giovanniâ€™s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-08-30T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="PiFace Digital 2 - Creare una Web interface in PHP" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Giovanni De Costanzo"},"url":"https://gdecostanzo.github.io/PiFace-Web","headline":"PiFace Digital 2 - Creare una Web interface in PHP","@type":"BlogPosting","description":"This is the personal website of Giovanni De Costanzo.","datePublished":"2016-08-30T00:00:00+02:00","dateModified":"2016-08-30T00:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://gdecostanzo.github.io/PiFace-Web"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link type="application/atom+xml" rel="alternate" href="https://gdecostanzo.github.io/feed.xml" title="Giovanni&apos;s Blog" /><link rel="alternate" type="application/rss+xml" href="https://gdecostanzo.github.io/feed.xml">
</head><body>

    <div id="layout" class="pure-g"><aside class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="sidebar-info">
        <a href="/">
            <span hidden>Giovanni's Blog
                Header Image</span>
            <img class="brand-photo" src="https://gdecostanzo.github.io/assets/profile_pic.jpg" alt="Photo of Giovanni De Costanzo"/>
        </a>
        <h1 class="brand-title">
            <a href="/">Giovanni's Blog</a>
        </h1>
        <h2 class="brand-tagline">This is the personal website of Giovanni De Costanzo. </h2>

        <nav class="nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a class="pure-button" href="https://gdecostanzo.github.io">Home</a>
                </li>
                <li class="nav-item">
                    <a class="pure-button" href="https://gdecostanzo.github.io/about">About Me</a>
                </li>
            </ul>
        </nav>
    </div>
</aside><div class="content pure-u-1 pure-u-md-3-4">
            <div class="md-display">
                <h1>
                    <a class="jekyll-header" href="/">Welcome to Giovanni's Blog</a>
                </h1><div class="menu">
    <div class="about">
        <a href="/about">
            <i class="fas fa-signature"></i>
            About
        </a>
    </div>
    <div class="hashtags">
        <a href="/tags">
            <i class="fas fa-hashtag"></i>
            Tags
        </a>
    </div>
    <div class="categories">
        <a href="/categories">
            <i class="far fa-folder-open"></i>
            Categories
        </a>
    </div>
    <div class="archive">
        <a href="/archive">
            <i class="fas fa-archive"></i>
            Archive
        </a>
    </div>
</div><div id="search">
    <label>
        <span class="search-icon">ðŸ”Ž</span>
        <input autocomplete="off" id="search-input" oninput="changeResultContainerDisp(this.value)" placeholder="Search all articles..." type="text"/>
    </label>

    <ul id="results-container" style="display: none"></ul>
</div>
<script src="/assets/simple-jekyll-search.js"></script>
<script>
    function changeResultContainerDisp(val) {
        if (val) {
            document
                .getElementById("results-container")
                .style
                .display = "block";
            document.getElementById("search-input").addEventListener("blur", function () {
                document.addEventListener("click", function (event) {
                    var isClickInside = document.getElementById("results-container").contains(event.target);
                    if (! isClickInside) {
                        document
                            .getElementById("results-container")
                            .style
                            .display = "none";
                    }
                })
            })
        } else {
            document
                .getElementById("results-container")
                .style
                .display = "none";
        }
    }
    var sjs = SimpleJekyllSearch({
        searchInput: document.getElementById("search-input"),
        resultsContainer: document.getElementById("results-container"),
        json: "/search.json",
        searchResultTemplate: "<li class='search_res' style='list-style: none;'><a href='https://gdecostanzo.github.io{url}' color: #555555;'><p><strong>></strong> {title}</p></a></li>",
        noResultsText: "No results found. Try another search.",
        fuzzy: false,
        limit: 5
    })
</script></div>
            <div>
                <article class="post-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
        <h2 class="post-title" itemprop="name headline">PiFace Digital 2 - Creare una Web interface in PHP</h2><p><time datetime="2016-08-30T00:00:00+02:00" itemprop="datePublished">
        Aug 30, 2016
    </time>&#8239;
    <span itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">By: Giovanni De Costanzo</span></span>&#8239;|&#8239;<a href="/tags/#InternetofThings">#InternetofThings</a> &#8239;<a href="/tags/#IoT">#IoT</a> &#8239;<a href="/tags/#piface">#piface</a> &#8239;<a href="/tags/#piface digital 2">#piface digital 2</a> &#8239;<a href="/tags/#pifaceio">#pifaceio</a> &#8239;<a href="/tags/#Programmazione">#Programmazione</a> &#8239;<a href="/tags/#Python">#Python</a> &#8239;<a href="/tags/#raspberry">#raspberry</a> &#8239;<a href="/tags/#raspberrypi">#raspberrypi</a> &#8239;</p></header>

    <div articlebody" class="post-body itemprop=">
        <figure>

<img data-width="1291" data-height="479" src="assets/posts/pifacedigital2.jpg" />  
</figure>

<p>In questo nuovo articolo vedremo come mettere in comunicazione il nostro programma in Python realizzato per la gestione della scheda PiFace con una interfaccia Web, utilizzando PHP.</p>

<p>Per poter mettere in comunicazione il programma scritto in Python con uno script PHP, creeremo delle connessioni socket per lo scambio di messaggi. In particolare, il seguente programma Python fungerÃ  da server, e verrÃ  messo in ascolto sulla porta 9000, in attesa di nuove connessioni client da parte di uno script PHP. Quando viene instaurata una nuova connessione, lâ€™oggetto conn viene passato ad un nuovo thread che, in base al comando ricevuto dal client (nel nostro caso â€˜0â€™, â€˜1â€™ oppure â€˜2â€™), restituisce lo stato della porta di input 0 oppure attiva e disattiva la porta di output 0 (accendendo e spegnendo quindi anche il relativo led).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import socket
import sys
import pifaceio
from thread import *

#---- piaceio read and write functions ------ 
pfio = pifaceio.PiFace()

def read_pin(pin):
   pfio.read()
   return pfio.read_pin(pin)

def write_pin(pin, state):
   pfio.write_pin(pin, state)
   pfio.write()
 

#---- Socket creation -------
HOST = '' # Symbolic name meaning all available interfaces
PORT = 9000 # Arbitrary non-privileged port
 
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print 'Socket created'

try:
   s.bind((HOST, PORT))
except socket.error as msg:
   print 'Bind failed. Error Code : ' + str(msg[0]) + ' Message ' + msg[1]
   sys.exit()
 
print 'Socket bind complete'
 
s.listen(10)
print 'Socket now listening'
 


#---- Function for handling connections. ------
#---- This will be used to create threads -----
def clientthread(conn):
 
   command = conn.recv(1) #Receive 1 Bytes
   if command == '0': #Return the state of input port 0
      if read_pin(0):
         conn.send('1')
      else:
         conn.send('0')
 
   elif command == '1':
      write_pin(0,0)
      conn.send('0')
 
   elif command == '2':
      write_pin(0,1)
      conn.send('0') 

   #came out of loop
   conn.close()
 

#--- Now waiting for a client connection -----
while 1:
   #wait to accept a connection - blocking call
   conn, addr = s.accept()
   print 'Connected with ' + addr[0] + ':' + str(addr[1])
 
   #start new thread takes 1st argument as a function name to be run 
   #second is the tuple of arguments to the function.
   start_new_thread(clientthread ,(conn,))
 
s.close()
</code></pre></div></div>

<p>Di seguito invece Ã¨ mostrato lo script PHP utilizzato come client il quale, invocato tramite una chiamata AJAX da interfaccia Web, riceve come parametro GET il comando da inviare, si collega al server e invia il comando; resta quindi in attesa di una risposta che sarÃ  poi stampata prima di terminare.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$host</span> <span class="o">=</span> <span class="s2">"localhost"</span><span class="p">;</span>
<span class="nv">$port</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">;</span>

<span class="nv">$cmd</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]</span> <span class="p">;</span>

<span class="nv">$socket1</span> <span class="o">=</span> <span class="nb">socket_create</span><span class="p">(</span><span class="no">AF_INET</span><span class="p">,</span> <span class="no">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s2">"Could not create socket</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>

<span class="nb">socket_connect</span> <span class="p">(</span><span class="nv">$socket1</span> <span class="p">,</span> <span class="nv">$host</span><span class="p">,</span><span class="nv">$port</span> <span class="p">)</span> <span class="p">;</span>

<span class="nb">socket_write</span><span class="p">(</span><span class="nv">$socket1</span><span class="p">,</span> <span class="nv">$cmd</span><span class="p">,</span> <span class="nb">strlen</span> <span class="p">(</span><span class="nv">$cmd</span><span class="p">))</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s2">"Could not write output</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>

<span class="nv">$response</span> <span class="o">=</span> <span class="nb">socket_read</span><span class="p">(</span><span class="nv">$socket1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">#read 1 byte</span>

<span class="k">echo</span> <span class="nv">$response</span><span class="p">;</span>

<span class="nb">socket_close</span><span class="p">(</span><span class="nv">$socket1</span><span class="p">)</span> <span class="p">;</span>

<span class="cp">?&gt;</span>
</code></pre></div></div>

    </div><div id="author">
    <h3>About
        Giovanni De Costanzo</h3>
    <img src="assets/author-pic.png" alt="Photo of Giovanni De Costanzo"/>
    <p>My name is Giovanni De Costanzo and I'm an IT professional. I'm a geek, passionate about all the tech world since early age.</p>
</div><a class="u-url" href="/PiFace-Web" hidden></a>
</article><hr/>

<footer class="footer">
    <div class="pure-menu pure-menu-horizontal">
        <ul>
            <li class="pure-menu-item">
                <a class="pure-menu-link" href="/">
                    <i class="fas fa-home"></i>
                    <span class="md-display">Home</span>
                </a>
            </li>
            <li class="pure-menu-item">
                <a class="pure-menu-link" href="https://www.linkedin.com/in/giovanni-de-costanzo-54b6b083/">
                    <i class="fab fa-linkedin"></i>
                    <span class="md-display">Linkedin</span>
                </a>
            </li>
            <li class="pure-menu-item">
                <a class="pure-menu-link" href="https://github.com/gdecostanzo">
                    <i class="fab fa-github"></i>
                    <span class="md-display">GitHub</span>
                </a>
            </li>
            <li class="pure-menu-item">
                <a class="pure-menu-link" href="mailto:mail@giovannidecostanzo.it">
                    <i class="fas fa-paper-plane"></i>
                    <span class="md-display">E-mail</span>
                </a>
            </li>
            <li class="pure-menu-item">
                <a class="pure-menu-link" href="https://www.facebook.com/giovanni.decostanzo">
                    <i class="fab fa-facebook"></i>
                    <span class="md-display">Facebook</span>
                </a>
            </li>
            <li class="pure-menu-item">
                <a class="pure-menu-link" href="https://www.instagram.com/g.decostanzo/">
                    <i class="fab fa-instagram"></i>
                    <span class="md-display">Instagram</span>
                </a>
            </li>
            <li class="pure-menu-item">
                <a class="pure-menu-link" href="/assets/gioco15">
                    <i class="fas fa-dice" aria-hidden="true"></i>
                    <span class="md-display">My 15 Puzzle</span>
                </a>
            </li>
        </ul>
    </div>
</footer></div>
        </div>
    </div>

</body>

</html>